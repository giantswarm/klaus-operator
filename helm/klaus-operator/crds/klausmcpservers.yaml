apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: klausmcpservers.klaus.giantswarm.io
  annotations:
    controller-gen.kubebuilder.io/version: (devel)
spec:
  group: klaus.giantswarm.io
  names:
    kind: KlausMCPServer
    listKind: KlausMCPServerList
    plural: klausmcpservers
    singular: klausmcpserver
    shortNames:
      - kms
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Type
          type: string
          jsonPath: .spec.type
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      schema:
        openAPIV3Schema:
          description: >-
            KlausMCPServer defines a shared MCP server configuration that can be
            referenced by KlausInstance resources. The operator resolves these
            references and assembles the MCP config with Secret injection.
            Full implementation in #5.
          type: object
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              description: KlausMCPServerSpec defines the MCP server configuration.
              type: object
              required:
                - type
              properties:
                type:
                  description: Transport type (e.g. "streamable-http", "sse", "stdio").
                  type: string
                url:
                  description: URL for HTTP-based MCP servers.
                  type: string
                command:
                  description: Command for stdio-based MCP servers.
                  type: string
                args:
                  description: Arguments for stdio-based MCP servers.
                  type: array
                  items:
                    type: string
                env:
                  description: Static environment variables.
                  type: object
                  additionalProperties:
                    type: string
                secretRefs:
                  description: >-
                    Secret references for credential injection. Each entry maps
                    environment variable names to Secret keys, enabling ${VAR}
                    expansion in the MCP config.
                  type: array
                  items:
                    type: object
                    required:
                      - secretName
                      - env
                    properties:
                      secretName:
                        description: Name of the Kubernetes Secret.
                        type: string
                      env:
                        description: Maps env var names to Secret keys.
                        type: object
                        additionalProperties:
                          type: string
                headers:
                  description: HTTP headers for HTTP-based MCP servers.
                  type: object
                  additionalProperties:
                    type: string
            status:
              description: KlausMCPServerStatus defines the observed state.
              type: object
              properties:
                instanceCount:
                  description: Number of instances referencing this MCP server.
                  type: integer
